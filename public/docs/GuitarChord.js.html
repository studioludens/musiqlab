<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: guitar/GuitarChord.js</title>
    
    <script src="scripts/jquery-1.9.1.min.js"></script>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Bootstrap -->
    <link rel="stylesheet" media="screen" href="../style/bootstrap.min.css">
    <!-- responsive sheets -->
    <link href="../style/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="../style/docs.css" rel="stylesheet">
    
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="styles/custom.css">
    
    
          
    <script>
        $(document).ready(function(w){
            
            // toggle handlers for the data titles
            $('dt.doc-header').click(function(){
                //alert("It works");
                $(this).next('dd').toggle(100);
                //$(this).toggle();
            });
        });
    </script>
</head>

<body>

<div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">MUSIQ Lab</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li><a href="#">Home</a></li>
              <li>
                <a href="musiq.html" class="dropdown" data-toggle="dropdown">MUSIQ.js</a>
                <ul class="dropdown-menu">
                    <li><a href="tutorials/">Tutorials</a></li>
                    <li class="active"><a href="docs/index.html">API Documentation</a></li>
                    <li><a href="http://github.com/studioludens/musiqjs/">Github</a></li>
                </ul>
              </li>
              <li><a href="guitar.html">Interactive Guitar</a></li>
              <li><a href="#about">About</a></li>
              <li><a href="#contact">Contact</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">
        
        <div class="row">
            <div class="span3 bs-docs-sidebar">
                    <ul class="nav nav-list bs-docs-sidenav affix"><li class="active"><a href="index.html"><i class="icon-chevron-right"></i>Index</a></li><li class="nav-header">Classes</li><li><a href="Chord.html"><i class="icon-chevron-right"></i>Chord</a></li><li><a href="Chords.html"><i class="icon-chevron-right"></i>Chords</a></li><li><a href="Guitar.html"><i class="icon-chevron-right"></i>Guitar</a></li><li><a href="GuitarChord.html"><i class="icon-chevron-right"></i>GuitarChord</a></li><li><a href="GuitarFret.html"><i class="icon-chevron-right"></i>GuitarFret</a></li><li><a href="GuitarNote.html"><i class="icon-chevron-right"></i>GuitarNote</a></li><li><a href="GuitarString.html"><i class="icon-chevron-right"></i>GuitarString</a></li><li><a href="Interval.html"><i class="icon-chevron-right"></i>Interval</a></li><li><a href="Note.html"><i class="icon-chevron-right"></i>Note</a></li><li><a href="Scale.html"><i class="icon-chevron-right"></i>Scale</a></li><li class="nav-header">Namespaces</li><li><a href="MUSIQ.html"><i class="icon-chevron-right"></i>MUSIQ</a></li></ul>
            </div>
            <div class="span9">
                <div class="page-header">
                    <h1 class="page-title">Source: guitar/GuitarChord.js</h1>
                </div>
                


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
 * GuitarChord - a class for representing a guitar chord
 * 
 * 
 * @constructor
 * 
 * @param {Guitar} guitar - a Guitar object on which this chord is played
 * @param {Chord}  chord - a Chord object
 * @param {array}  notes - a collection of GuitarNote objects (optional)
 */

var GuitarChord = function( guitar, chord, notes  ){
    
    this.guitar = guitar;
    this.chord = chord;
    this.notes = notes;
    
    this._barre = 0;
};

/**
 * maximum finger stretch
 */
GuitarChord.MAX_STRETCH = 4;


/**
 * finds all variations of a particular chord with a specific
 * tonic. All these 
 * 
 * @param guitar {Guitar} - the guitar object (with specific tuning)
 * @param chord {Chord} - the Chord object to find specific GuitarChords for
 * @param base {GuitarNote} the Base note we want to base the chord on (GuitarNote)
 * @param options {object} an object specifying more options:
 *                  
 *                      upPreference: false
 *                      maxFingerStretch: 2
 *                      maxDifficulty: 10 
 *                  
 * 
 * @returns {array} an array of GuitarChord objects
 */
GuitarChord.fromChordAndBase = function( guitar, chord, base ){
    
    // from the base, walk up the neck, fret by fret
    
    var baseString = base.pos[0];
    var baseFret = base.pos[1];
    
    var numNotes = chord.notes.length - (chord.optional ? chord.optional.length : 0);
    
    
    /* a list of all five fingers the user has in his left hand
       In case you're Django, please remove the last three
       items from the list
       
       This will be used to determine the 'easyness' of the chord
       
    */
    
    /**
     * how easy it is to play the chord.
     * 
     * these factors add weight:
     * - each note played
     *   + 1 for each note played
     * - the distance of each note relative to the previous note
     *   + 1 for each extra fret distance between two notes
     * - the distance of the note to the base note
     * - the number of fingers used
     *   + 1 for each finger used, + 100 if more than all fingers are used (impossible)
     * 
     * lower is better, no note has ease 0,
     * 1 note at least ease 1
     */
    var ease = 0;
    
    var fingersUsed = [ false, false, false, false, false];
    // exit if we have more required notes than possible frets to
    
    
    //var foundNotes = [];
    
    var lookup = function( chordNotes, baseString, foundNotes){
        
        if( baseString + numNotes > guitar.strings.length){
            //console.warn( "Not enough strings to find notes on!" + (guitar.strings.length - baseString));
            return;
        }
    
        for( var i = baseString; i &lt; guitar.strings.length ; i++){
            // get all notes on the string that match the chord 
            var stringNotes = _(guitar.notes[i]).filter(function(note){
                return _(chordNotes).contains(note.relPos());
            });

            // and are close enough to the base note
            stringNotes = _(stringNotes).filter(function(note){
                if( Math.abs( note.distanceTo(base)[1] ) &lt;= GuitarChord.MAX_STRETCH ){
                    console.log("Found note " + note.simple() + " on pos [" + note.pos + "]");
                    return true;
                }
            });
            
            // if we have notes left, these 
            // are potentially interesting
            if( !stringNotes || stringNotes.length == 0 ){
                console.log("No notes on string found!");
            } else if( stringNotes.length == 1 ){
                //console.log("One matching note on string found!");
                //console.log( stringNotes );
                foundNotes.push( stringNotes );
                
            } else {
                // more notes found!
                console.log( stringNotes.length + " matching note on string found!");
                //console.log( stringNotes );
                
                // for now, return the combined array
                foundNotes.push( stringNotes );
                
            }
        };
        
        // check if we have really found all notes in the chord
        
        var lowestFret = 1000;
        var highestFret = -1;
        
        var stringNotes = _(foundNotes).each(function(notes){
            lowestFret = Math.min(notes[0].pos[1], lowestFret);
            highestFret = Math.max(notes[0].pos[1], highestFret);
        });
        
        console.log( "Biggest distance between frets: " + highestFret-lowestFret);
        
        return foundNotes;
        
    };
    
    var chordNotes = lookup( chord.notes, baseString, []);
    // look them up - recursively
    //console.log("FoundNotes:");
    //console.log(foundNotes);
    /*_(chordNotes).reduce(function(memo, note, index, list){
        // first item
        if( !memo ) memo = [];
        memo.push(note);
    })*/
    
    // check if we have found all the notes
    
    // can we calculate this recursively
    return chordNotes;
};

/**
 * finds all variations of a particular chord on the guitar neck
 * 
 * the chord should be relative
 * - find the tonic on each fret
 * 
 * @param guitar {Guitar} - A Guitar object
 * @param chord {Chord} - A chord object
 * 
 * @returns {GuitarChord}
 */
GuitarChord.fromChord = function( guitar, chord ){
    
    if( !chord.relative ){
        console.warn("Relative chord not allowed!");
        return;
    }
    
    // get all base (lowest) notes
    var baseNotes = [];
    
    // we only have to check the bottom four strings
    
    _(guitar.notes).each(function(string_notes, str_num){
        _(string_notes).each(function(note, fret_num){
            //console.log(note);
            if( chord.contains(note.note) ){
                //console.log(note);
                baseNotes.push( note );
            }
        });
    });
    
    console.log(baseNotes);
    
    // get all possible chord variations for each chord
    return _.compact( _(baseNotes).map(function(base){
        var guitarChord = GuitarChord.fromChordAndBase( guitar, chord, base );
        return guitarChord;
    }));
};

/**
 * check if a guitar chord is valid
 * this is when all notes can be matched
 * with a note in the chord object.
 * 
 * 
 * 
 * @returns {boolean} - true if the chord is valid
 * 
 * @todo implement function
 */
GuitarChord.prototype.valid = function(){
    
};

/**
 * barre - 
 * 
 * @returns {integer}   how many fingers can be played barre. Calculated from the
 *                      top string
 * 
 * @todo test function
 */
GuitarChord.prototype.barre = function(){
    // check highest strings and recurse down, adding as we go
    var same = 0;
    var lastFret = _(this.guitar.frets).last();
    
    _(this.notes).pluck('fret').reverse().each(function(item){
        if( item == lastFret ) same++;
    });
    
    console.log(same);
    return same;
    
};</code></pre>
        </article>
    </section>




            </div>
        </div>
        
        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0-dev</a> on Sat Mar 23 2013 09:34:34 GMT-0400 (EDT)
        </footer>
    </div>



<script> prettyPrint(); </script>
<script src="../script/lib/bootstrap/bootstrap.min.js"></script>
</body>
</html>
